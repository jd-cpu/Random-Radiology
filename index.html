<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>영상의학과 랜덤 Post-test 퀴즈</title>
  <link rel="manifest" href="manifest.json?v=5">
  <meta name="theme-color" content="#4CAF50">
  <style>
    body { font-family: Arial, sans-serif; max-width:800px; margin:20px auto; padding:16px; text-align:center; }
    header { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    h1 { margin:0; font-size:1.25rem; }
    #status { color:#666; font-size:0.95rem; margin-top:8px; text-align:left; }
    .question { margin:20px 0; font-size:1.15rem; white-space:pre-line; text-align:left; }
    .answer { margin-top:10px; font-weight:600; color:#0a6; white-space:pre-line; display:none; text-align:left; }
    .controls { margin-top:18px; }
    button { padding:10px 14px; margin:6px; font-size:1rem; }
    .progress-wrap { margin-top:14px; text-align:left; }
    .progress-info { font-size:0.92rem; color:#444; margin-bottom:6px; }
    .progress-bar { width:100%; height:12px; background:#eee; border-radius:8px; overflow:hidden; }
    .progress-inner { height:100%; width:0%; background:#4caf50; transition: width 0.25s ease; }
    small.note { display:block; color:#888; margin-top:8px; text-align:left; }
  </style>
</head>
<body>
  <header>
    <h1>영상의학과 랜덤 Post-test 퀴즈</h1>
    <div>
      <button id="btnToggleMode">복습 모드로</button>
      <button id="btnReset">초기화</button>
    </div>
  </header>

  <div id="status" aria-live="polite">로딩 중...</div>

  <div class="question" id="question">문제가 여기에 표시됩니다.</div>
  <div class="answer" id="answer"></div>

  <div class="controls" id="controls">
    <button id="btnShowAnswer">정답 보기</button>
    <button id="btnMarkWrong">오답 저장</button>
    <button id="btnPrev">이전 문제</button>
    <button id="btnNext">다음 문제</button>
    <!-- 복습 모드에서 첫 문제로 돌아가기 버튼 -->
    <button id="btnRestartReview" style="display:none;">복습 첫 문제로</button>
    <!-- 복습 모드에서 오답 제거 버튼 -->
    <button id="btnRemoveWrong" style="display:none;">오답 제거</button>
  </div>

  <div class="progress-wrap">
    <div class="progress-info" id="progressInfo">진행: 0 / 0 (남음: 0)</div>
    <div class="progress-bar"><div id="progressInner" class="progress-inner"></div></div>
    <small class="note">※ 정답 보기 버튼은 정답만 보여줍니다. 다음 문제로 이동하려면 '다음 문제' 버튼을 누르세요.</small>
  </div>

<script>
  // 기존 문제 데이터
  const questions = [
    { q: "<img src='1.png' style='max-width:600px;'>", a: "Kidney" },
    { q: "<img src='2.png' style='max-width:600px;'>", a: "Portal vein, gallbladder" },
    { q: "<img src='4.png' style='max-width:600px;'>", a: "Duodenum" },
    { q: "<img src='5.png' style='max-width:600px;'>", a: "Celiac trunk(artery)" },
    { q: "<img src='6.png' style='max-width:600px;'>", a: "Scaphoid" },
    { q: "<img src='7.png' style='max-width:600px;'>", a: "Pituitary gland, pons" },
    { q: "<img src='8.png' style='max-width:600px;'>", a: "Lateral ventricle, thalamus" },
    { q: "<img src='9.png' style='max-width:600px;'>", a: "Anterior cerebral artery, middle cerebral artery, internal carotid artery" },
    { q: "<img src='10.png' style='max-width:600px;'>", a: "Ethmoid sinus" },
    { q: "Rt. ankle <br><img src='11.png' style='max-width:600px;'>", a: "Talus" },
    { q: "<img src='12.png' style='max-width:600px;'>", a: "Trachea" },
    { q: "<img src='13.png' style='max-width:600px;'>", a: "Main pulmonary trunk = main pulmonary artery = pulmonary artery = pulmonary trunk" },
    { q: "<img src='14.png' style='max-width:600px;'>", a: "Pedicle" },
    { q: "<img src='15.png' style='max-width:600px;'>", a: "Left anterior descending artery" },
    { q: "<img src='16.png' style='max-width:600px;'>", a: "Common carotid artery" },
    { q: "각각 axial view, coronal view <br><img src='17.png' style='max-width:600px;'><img src='18.png' style='max-width:600px;'>", a: "Maxillary sinus" },
    { q: "<img src='19.png' style='max-width:600px;'>", a: "Left subclavian artery" },
    { q: "<img src='20.png' style='max-width:600px;'>", a: "Common iliac artery" },
    { q: "<img src='21.png' style='max-width:600px;'>", a: "Common hepatic artery" },
    { q: "GI tract 수술 환자의 투시 검사에서 사용할 수 있는 조영제는?", a: "Gastrografin" },
    { q: "<img src='22.png' style='max-width:600px;'>", a: "Splenic vein" },
    { q: "<img src='23.png' style='max-width:600px;'>", a: "Superior mesenteric artery" },
    { q: "<img src='24.png' style='max-width:600px;'>", a: "Renal artery" },
    { q: "<img src='25.png' style='max-width:600px;'>", a: "Trapezoid" },
    { q: "<img src='26.png' style='max-width:600px;'>", a: "Capitate" },
    { q: "<img src='27.png' style='max-width:600px;'>", a: "Corpus callosum" },
    { q: "<img src='28.png' style='max-width:600px;'>", a: "Midbrain" },
    { q: "<img src='29.png' style='max-width:600px;'>", a: "Caudate nucleus" },
    { q: "<img src='30.png' style='max-width:600px;'>", a: "Basilar artery" },
    { q: "<img src='31.png' style='max-width:600px;'>", a: "Sphenoid sinus" },
    { q: "<img src='32.png' style='max-width:600px;'>", a: "Navicular" },
    { q: "<img src='33.png' style='max-width:600px;'>", a: "Superior vena cava" },
    { q: "<img src='34.png' style='max-width:600px;'>", a: "Azygos vein" },
    { q: "<img src='35.png' style='max-width:600px;'>", a: "Spinal canal" },
    { q: "<img src='36.png' style='max-width:600px;'>", a: "Pedicle" },
    { q: "<img src='37.png' style='max-width:600px;'>", a: "Right coronary artery" },
    { q: "<img src='38.png' style='max-width:600px;'>", a: "Internal jugular vein" },
    { q: "<img src='39.png' style='max-width:600px;'>", a: "Trachea" },
    { q: "<img src='40.png' style='max-width:600px;'>", a: "Maxillary sinus" },
    { q: "<img src='41.png' style='max-width:600px;'>", a: "Esophagus" },
    { q: "<img src='42.png' style='max-width:600px;'>", a: "Descending aorta" },
    { q: "<img src='43.png' style='max-width:600px;'>", a: "Common iliac artery" },
    { q: "<img src='44.png' style='max-width:600px;'>", a: "Common hepatic artery" },
    { q: "<img src='45.png' style='max-width:600px;'>", a: "Ascending aorta" },
    { q: "Axillary lymph node를 level 1, 2, 3으로 나누는 기준이 되는 근육은?", a: "Pectoralis minor muscle" },
    { q: "<img src='46.png' style='max-width:600px;'>", a: "Pancreas(head)" },
    { q: "<img src='47.png' style='max-width:600px;'>", a: "Gallbladder" },
    { q: "<img src='48.png' style='max-width:600px;'>", a: "4th ventricle" },
    { q: "<img src='49.png' style='max-width:600px;'>", a: "Lentiform nucleus" },
    { q: "Rt. ankle <br><img src='50.png' style='max-width:600px;'>", a: "Calcaneus" },
    { q: "<img src='51.png' style='max-width:600px;'>", a: "Major fissure" },
    { q: "Lumbar vertebra <br><img src='52.png' style='max-width:600px;'>", a: "Transverse process" },
    { q: "Neck CT axial view <br><img src='53.png' style='max-width:600px;'>", a: "Sternocleidomastoid muscle, thyroid gland" },
    { q: "<img src='54.png' style='max-width:600px;'>", a: "Maxillary sinus, nasolacrimal duct, frontal sinus" },
    { q: "Celiac trunk angiography <br><img src='55.png' style='max-width:600px;'>", a: "Common hepatic artery, splenic artery" },
    { q: "<img src='56.png' style='max-width:600px;'>", a: "Nucleus pulposus" },
    { q: "<img src='57.png' style='max-width:600px;'>", a: "Submandibular gland" },
    { q: "<img src='58.png' style='max-width:600px;'>", a: "Hyoid bone, cricoid cartilage" },
    { q: "Celiac trunk angiography <br><img src='59.png' style='max-width:600px;'>", a: "Common hepatic artery" },
    { q: "<img src='60.png' style='max-width:600px;'>", a: "Renal artery" },
    { q: "<img src='61.png' style='max-width:600px;'>", a: "pulmonary trunk" },
    { q: "<img src='62.png' style='max-width:600px;'>", a: "(왼쪽 위부터 반시계 방향으로)Liver, kidney, psoas muscle, aorta, spleen" },
    { q: "<img src='63.png' style='max-width:600px;'>", a: "(왼쪽 위부터 반시계 방향으로)Portal vein, bladder, gallbladder, stomach" },
    { q: "<img src='64.png' style='max-width:600px;'>", a: "(왼쪽 위부터 반시계 방향으로)Superior vena cava, esophagus, descending aorta, main pulmonary trunk, ascending aorta" },
    { q: "<img src='65.png' style='max-width:600px;'>", a: "Thyroid cartilage" },
    { q: "<img src='66.png' style='max-width:600px;'>", a: "Anterior cerebral artery, middle cerebral artery, vertebral artery" },
    { q: "<img src='67.png' style='max-width:600px;'>", a: "(왼쪽 위부터 반시계 방향으로)Trapezium, scaphoid, lunate, capitate, trapezoid" },
    { q: "<img src='68.png' style='max-width:600px;'>", a: "Duodenum, pancreas(head), splenic vein" },
    { q: "<img src='69.png' style='max-width:600px;'>", a: "Portal vein, bladder, gallbladder, stomach" },
    { q: "<img src='70.png' style='max-width:600px;'>", a: "Bladder, prostate, seminal vesicle, rectum" },
    { q: "<img src='71.png' style='max-width:600px;'>", a: "Celiac trunk, rt. common iliac artery, superior mesenteric artery, lt. renal artery" },
    { q: "<img src='72.png' style='max-width:600px;'>", a: "Trapezium, scaphoid, capitate, trapezoid, lunate" },
    { q: "<img src='73.png' style='max-width:600px;'>", a: "Corpus callosum, pituitary gland, midbrain, pons, 4th ventricle" },
    { q: "<img src='74.png' style='max-width:600px;'>", a: "Lateral ventricle, caudate nucleus, lentiform nucleus, thalamus, corpus callosum(splenium of corpus callosum)" },
    { q: "<img src='75.png' style='max-width:600px;'>", a: "Ethmoid sinus, sphenoid sinus, internal auditory canal" },
    { q: "<img src='76.png' style='max-width:600px;'>", a: "Substantia nigra, red nucleus" },
    { q: "<img src='77.png' style='max-width:600px;'>", a: "Navicular, cuneiform, 1st metatarsal, talus, calcaneus" },
    { q: "<img src='78.png' style='max-width:600px;'>", a: "Trachea, rt. main bronchus, bronchus intermedius" },
    { q: "<img src='79.png' style='max-width:600px;'>", a: "Minor fissure, major fissure" },
    { q: "<img src='80.png' style='max-width:600px;'>", a: "Ascending aorta, main pulmonary artery(trunk), descending aorta, superior vena cava, esophagus" },
    { q: "<img src='81.png' style='max-width:600px;'>", a: "Rt. pectoralis major muscle, rt. pectoralis minor muscle, lt. innominate vein(lt. brachiocephalic vein)" },
    { q: "<img src='82.png' style='max-width:600px;'>", a: "Azygos vein, AP window(aortopulmonary window)" },
    { q: "각각의 명칭과 설명을 쓰시오. <br><img src='83.png' style='max-width:600px;'>", a: "1. Consolidation: 폐포내 공기가 액체 세포 조직 및 다른 물질로 대부분 혹은 완전히 대체된 것. 폐혈관이나 기관지음영의 윤곽 소실 <br>2. GGO: 폐혈관이나 기관지 음영의 윤곽을 소실시키지 않는 정도의 증가음영<br>3. Air bronchogram: 통기가 되지 않아 음영이 증가된 폐 실질(consolidation or GGO)과 대조되어 공기로 찬 기관지가 저음영으로 보이는 것을 말함" },
    { q: "?에 들어갈 말을 쓰고, 간단히 설명하시오. <br><img src='84.png' style='max-width:600px;'>", a: "Honeycomb, 섬유화로 인한 폐조직의 파괴 및 폐포의 용해와 동반된 두꺼운 벽을 가지는 다수의 낭포성 공기공간. 낭포의 직경은 수 mm에서 수 cm에 이르며 다양한 벽두께를 보임. PF/UIP 진단에 중요하다" },
    { q: "1, 2, 3, 4를 쓰고, 3을 설명하시오. <br><img src='85.png' style='max-width:600px;'>", a: "1. Interlobular septal thickening <br>2. Intralobular septal thickening <br>3. Secondary pulmonary, the functional unit of the lung and is the key to HRCT terminology. Secondary pulmonary lobules measures between 1 and 2.5 cm across. They are polyhedral in shape bounded by fibrous septa (the interlobular septa) which are themselves continuous with the peribronchovascular interstitium (axial connective tissue) and pleura (peripheral connective tissue). <br>4. Interlobular septa" },
    { q: "<img src='86.png' style='max-width:600px;'>", a: "Vertebral body medullary bone, spinal canal, superior articular facet, pedicle, transverse process" },
    { q: "<img src='87.png' style='max-width:600px;'>", a: "Neural foramen, superior articular process, pedicle, annulus fibrosus, nucleus pulposus" },
    { q: "<img src='88.png' style='max-width:600px;'>", a: "Superior vena cava, right ventricle, left ventricle, pulmonary artery(trunk), aorta" },
    { q: "<img src='89.png' style='max-width:600px;'>", a: "Left atrium, left anterior descending artery" },
    { q: "<img src='90.png' style='max-width:600px;'>", a: "Right atrium, right coronary artery, left circumflex artery" },
    { q: "<img src='91.png' style='max-width:600px;'>", a: "Sternocleidomastoid muscle, thyroid gland, common carotid artery, internal jugular vein" },
    { q: "<img src='92.png' style='max-width:600px;'>", a: "Hyoid bone, thyroid cartilage, cricoid cartilage" },
    { q: "<img src='93.png' style='max-width:600px;'>", a: "Larynx, trachea" },
    { q: "<img src='94.png' style='max-width:600px;'>", a: "Parotid gland, submandibular gland" },
    { q: "<img src='95.png' style='max-width:600px;'>", a: "Brachiocephalic trunk, lt. common carotid artery, lt. subclavian artery, descending aorta" },
    { q: "<img src='96.png' style='max-width:600px;'>", a: "Common iliac artery, internal iliac artery, external iliac artery" },
    { q: "<img src='97.png' style='max-width:600px;'>", a: "Rt. hepatic artery, lt. hepatic artery, gastroduodenal artery, common hepatic artery, splenic artery" },
    { q: "<img src='98.png' style='max-width:600px;'>", a: "Pulmonary artery, ascending aorta" }
  ];

  const KEY = {
    WRONG: 'quiz_wrong_v1',
    MODE: 'quiz_mode_v1',
    NORMAL_ORDER: 'quiz_normal_order_v1',
    NORMAL_IDX: 'quiz_normal_idx_v1',
    REVIEW_ORDER: 'quiz_review_order_v1',
    REVIEW_IDX: 'quiz_review_idx_v1'
  };

  let wrongList   = JSON.parse(localStorage.getItem(KEY.WRONG) || '[]');
  let mode        = localStorage.getItem(KEY.MODE) || 'normal';
  let orderNormal = JSON.parse(localStorage.getItem(KEY.NORMAL_ORDER) || 'null');
  let idxNormal   = parseInt(localStorage.getItem(KEY.NORMAL_IDX) || '0', 10);
  let orderReview = JSON.parse(localStorage.getItem(KEY.REVIEW_ORDER) || 'null');
  let idxReview   = parseInt(localStorage.getItem(KEY.REVIEW_IDX) || '0', 10);

  const elStatus          = document.getElementById('status');
  const elQuestion        = document.getElementById('question');
  const elAnswer          = document.getElementById('answer');
  const elBtnShow         = document.getElementById('btnShowAnswer');
  const elBtnWrong        = document.getElementById('btnMarkWrong');
  const elBtnNext         = document.getElementById('btnNext');
  const elBtnPrev         = document.getElementById('btnPrev');
  const elBtnToggle       = document.getElementById('btnToggleMode');
  const elBtnReset        = document.getElementById('btnReset');
  const elProgressInfo    = document.getElementById('progressInfo');
  const elProgressInner   = document.getElementById('progressInner');
  const elBtnRestartReview= document.getElementById('btnRestartReview');
  const elBtnRemoveWrong  = document.getElementById('btnRemoveWrong');

  function shuffledArray(n){
    const arr = Array.from({length:n}, (_,i)=>i);
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  function saveAll(){
    localStorage.setItem(KEY.WRONG, JSON.stringify(wrongList));
    localStorage.setItem(KEY.MODE, mode);
    if(orderNormal) localStorage.setItem(KEY.NORMAL_ORDER, JSON.stringify(orderNormal));
    localStorage.setItem(KEY.NORMAL_IDX, String(idxNormal));
    if(orderReview) localStorage.setItem(KEY.REVIEW_ORDER, JSON.stringify(orderReview));
    localStorage.setItem(KEY.REVIEW_IDX, String(idxReview));
  }

  function clearAll(){
    localStorage.removeItem(KEY.WRONG);
    localStorage.removeItem(KEY.MODE);
    localStorage.removeItem(KEY.NORMAL_ORDER);
    localStorage.removeItem(KEY.NORMAL_IDX);
    localStorage.removeItem(KEY.REVIEW_ORDER);
    localStorage.removeItem(KEY.REVIEW_IDX);
    wrongList = [];
    mode = 'normal';
    orderNormal=null; orderReview=null;
    idxNormal=0; idxReview=0;
  }

  function ensureOrders(skipShuffle=false){
    // ✅ 일반 모드 순서 보장 (기본: 처음 한 번 섞고 고정)
    if(!Array.isArray(orderNormal) || orderNormal.length !== questions.length){
      orderNormal = Array.from({length: questions.length}, (_,i)=>i);
      if(!skipShuffle){
        orderNormal.sort(()=>Math.random()-0.5);
      }
    }

    // ✅ 복습 모드 순서 보장
    if(!Array.isArray(orderReview) || orderReview.length !== wrongList.length){
      orderReview = Array.from({length: wrongList.length}, (_,i)=>i);
    }

    // ✅ 인덱스 보정
    idxNormal = Math.min(Math.max(0, idxNormal), Math.max(0, orderNormal.length-1));
    idxReview = Math.min(Math.max(0, idxReview), Math.max(0, wrongList.length-1));
  }

  function currentListAndIndex(){
    if(mode==='normal'){
      return {listType:'normal', order:orderNormal, idx:idxNormal, total:orderNormal.length};
    } else {
      return {listType:'review', order:orderReview, idx:idxReview, total:orderReview.length};
    }
  }

  function getCurrentQuestion(){
    const info = currentListAndIndex();
    if(info.total===0) return null;
    if(info.listType==='normal'){
      return questions[info.order[info.idx]];
    } else {
      return wrongList[info.order[info.idx]];
    }
  }

  function updateProgressBar(idx,total,percent){
    elProgressInfo.innerText=`진행: ${idx}/${total}  (${percent}%)`;
    elProgressInner.style.width=total===0?'0%':`${percent}%`;
  }

  function updateToggleText(){
    elBtnToggle.textContent = mode==='normal'?`복습 모드 (${wrongList.length})`:'일반 모드로';
  }

  function render(skipShuffle=false){
    ensureOrders(skipShuffle);
    saveAll();
    const info=currentListAndIndex();

    // 버튼 표시
    if(mode==='review' && info.total>0){
      elBtnRestartReview.style.display='inline-block';
      elBtnRemoveWrong.style.display='inline-block';
    } else {
      elBtnRestartReview.style.display='none';
      elBtnRemoveWrong.style.display='none';
    }

    if(info.total===0){
      elStatus.innerText = mode==='normal'? '문제가 비어있습니다. questions 배열을 채워주세요.' : '복습할 문제가 없습니다.';
      elQuestion.innerText = mode==='normal'? '문제가 없습니다.' : '복습할 문제가 없습니다.';
      elAnswer.style.display='none';
      updateProgressBar(0,info.total,0);
      updateToggleText();
      return;
    }

    // 완료 상태
    if(info.idx >= info.total){
      elQuestion.innerText='모든 문제가 완료되었습니다.';
      elAnswer.style.display='none';
      updateProgressBar(info.total, info.total, 100);
      updateToggleText();
      return;
    }

    const cur = getCurrentQuestion();
    if(!cur){
      elQuestion.innerText='문제가 없습니다.';
      elAnswer.style.display='none';
      updateProgressBar(info.idx,info.total,Math.round((info.idx/Math.max(1,info.total))*100));
      updateToggleText();
      return;
    }

    elQuestion.innerHTML = cur.q;
    elAnswer.innerHTML = cur.a;
    elAnswer.style.display='none';

    const currentNumber=info.idx+1;
    const remaining=Math.max(0,info.total-info.idx-1);
    elStatus.innerText=`모드: ${mode==='normal'?'일반':'복습'}  •  ${currentNumber} / ${info.total}  (남음: ${remaining})`;
    updateProgressBar(info.idx, info.total, Math.round((info.idx/Math.max(1,info.total))*100));
    updateToggleText();
  }

  function showAnswer(){
    const cur = getCurrentQuestion();
    if(!cur) return;
    elAnswer.style.display='block';
  }

  function markWrong(){
    const info=currentListAndIndex();
    if(info.total===0 || info.idx>=info.total) return;
    const cur=getCurrentQuestion();
    if(!cur) return;
    if(!wrongList.some(it=>it.q===cur.q && it.a===cur.a)){
      wrongList.push({q:cur.q,a:cur.a});
      orderReview = Array.from({length: wrongList.length}, (_,i)=>i); // 새로 고정
      idxReview=Math.min(idxReview, orderReview.length-1);
      saveAll();
      updateToggleText();
    }
  }

  function removeWrong(){
    const cur = getCurrentQuestion();
    if(!cur) return;
    if(removeFromWrongListByQA(cur.q, cur.a)){
      render();
    }
  }

  function nextQuestion(){
    const info=currentListAndIndex();
    if(info.total===0){ render(); return; }
    if(info.listType==='normal'){
      idxNormal++;
      if(idxNormal>info.total) idxNormal=info.total;
    } else {
      idxReview++;
      if(idxReview>info.total) idxReview=info.total;
    }
    saveAll();
    render();
  }

  function prevQuestion(){
    const info=currentListAndIndex();
    if(info.total===0){ render(); return; }
    if(info.listType==='normal'){
      if(idxNormal<=0) return;
      idxNormal = Math.max(0, idxNormal-1);
      const prev = questions[orderNormal[idxNormal]];
      if(prev) removeFromWrongListByQA(prev.q,prev.a);
    } else {
      if(idxReview<=0) return;
      idxReview=Math.max(0, idxReview-1);
    }
    saveAll();
    render();
  }

  function removeFromWrongListByQA(q,a){
    const i = wrongList.findIndex(it => it.q === q && it.a === a);
    if(i!==-1){
      wrongList.splice(i,1);
      // 순서 재구성 및 인덱스 보정
      orderReview = Array.from({length: wrongList.length}, (_,k)=>k);
      if(idxReview >= wrongList.length){
        idxReview = Math.max(0, wrongList.length - 1);
      }
      saveAll();
      updateToggleText();
      return true;
    }
    return false;
  }

  function restartReview(){
    idxReview=0;
    saveAll();
    render();
  }

  function toggleMode(){
    mode = (mode==='normal')?'review':'normal';
    localStorage.setItem(KEY.MODE, mode);
    if(mode==='review' && wrongList.length===0){
      alert('복습할 오답이 없습니다.');
      mode='normal';
      localStorage.setItem(KEY.MODE, mode);
      return;
    }
    ensureOrders();
    render();
  }

  function resetProgress(){
    if(!confirm('진행 상황(섞인 순서 및 인덱스)과 오답 목록을 초기화할까요?')) return;
    clearAll();
    ensureOrders();
    saveAll();
    render();
  }

  elBtnShow.addEventListener('click', showAnswer);
  elBtnWrong.addEventListener('click', markWrong);
  elBtnNext.addEventListener('click', nextQuestion);
  elBtnPrev.addEventListener('click', prevQuestion);
  elBtnToggle.addEventListener('click', toggleMode);
  elBtnReset.addEventListener('click', resetProgress);
  elBtnRestartReview.addEventListener('click', restartReview);
  elBtnRemoveWrong.addEventListener('click', removeWrong);

  if('serviceWorker' in navigator){
    window.addEventListener('load', ()=>{
      navigator.serviceWorker.register('sw.js?v=5').catch(e=>{
        console.warn('ServiceWorker 등록 실패:', e);
      });
    });
  }

  ensureOrders();
  render();
</script>
</body>
</html>
